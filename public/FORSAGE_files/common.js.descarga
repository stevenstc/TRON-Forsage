window.addEventListener('DOMContentLoaded', function () {
    
    //timer
    if(document.querySelector('.xGold-timer')) {
        const deadline = '2021-01-03T16:00+0300';
            function getTimeRemaining(endTime) {
                const t = Date.parse(endTime) - Date.parse(new Date),
                    //days = Math.floor(t / (1000 * 60 * 60 * 24)),
                    hours = Math.floor((t / (1000 * 60 * 60)  )),
                    minutes = Math.floor((t / 1000 / 60) % 60 ),
                    seconds = Math.floor((t / 1000) % 60 );
                
                return {
                    'total':t,
                    //'days': days,
                    'hours': hours,
                    'minutes': minutes,
                    'seconds': seconds
                };
            }
            function getZero(num) {
                if(num >=0 && num < 10) {
                    return `0${num}`;
                } else {
                    return num;
                }
            }

            function setClock(selector, endTime) {
                var timer = document.querySelector(selector);
                var hours = timer.querySelector('#hours'),
                    minutes = timer.querySelector('#minutes'),
                    seconds = timer.querySelector('#seconds'),
                    timeInterval = setInterval(updateClock, 1000);
                
                updateClock();

                function updateClock() {
                    var t = getTimeRemaining(endTime);
                    if(t.total > 0) {
                        //days.innerHTML = getZero(t.days);
                        hours.innerHTML= getZero(t.hours);
                        minutes.innerHTML= getZero(t.minutes);
                        seconds.innerHTML= getZero(t.seconds);
                    }
                    else {
                        clearInterval(timeInterval);
                        hours.innerHTML= '00';
                        minutes.innerHTML= '00';
                        seconds.innerHTML= '00';
                    }
                }
            }
            setClock('.xGold-timer', deadline);
        }

    // end timer
    
    
    
    $('.notifications__toggle').on('click', function(event) {
        $('.notifications__wrap').addClass('notifications__wrap_show');
    });
    $(document).mouseup(function (e){
        var div = $('.notifications__wrap');
        if (!div.is(e.target) && div.has(e.target).length === 0) {
            div.removeClass('notifications__wrap_show');
        }
    });
    setTimeout(function(){
        $('.notifications__alert').addClass('notifications__alert_hide');
    }, 3500);

        // Кнопка с последними событиями
    $('.notifications__toggle').click(function() {
        // Запомнить последний просмотренный ID события
        let key = $('.notifications__list').find(' > div:first-child').data('notification_time');
        if(key) {
            cookie('messageIteration', key, {expires: 2592e6});
        }
    });

    // Sockets
    eventsWebSocket();
});

function eventsWebSocket() {
    if(typeof io === 'undefined') {
        return false;
    }
    var params = {
        // Интервал вывода сообщений на экран в секундах
        delay   : 7,
        cookie: {
          // Сколько хранить куки, для итерации события(в секундах)
          expires: 2592e3,
        },
        message :
        {
            'Registration' : [
                l('ws-regLevel_0'),
                l('ws-regLevel_1'),
                l('ws-regLevel_2'),
                l('ws-regLevel_3'),
            ],
            'NewUserPlace'            : l('ws-newUserPlace'),
            'Upgrade'                 : l('ws-upgrade'),
            'Reinvest'                : l('ws-reinvest'),
            'MissedEthReceive'        : l('ws-missedEthReceive'),
            'SentExtraEthDividends'   : l('ws-sentExtraEthDividends'),
            'CannotSendMoneyEvent'    : l('ws-cannotSendMoneyEvent'),
            'leadingPartner'          : l('ws-leadingPartner'),
            'leadingPartnerToUpline'  : l('ws-leadingPartnerToUpline'),
            'leadingPlacePurchase'    : l('ws-leadingPlacePurchase'),
            'Transfer'                : l(''),
        },
        rates   : null,
        levels  : null,
        events  : new Array(),
        messageIteration: 0,
        storage: {
        },
        // Настройки контейнера
        container: {
            el:   $('.notifications__list'),
            cell: $('.notifications__alert'),
            btn:  $('.notifications__toggle'),
            wrapper:  $('.notifications__wrap'),
            countItems: 100,
        },
        // Иконка событий
        eventsTypeIcon: {
          'Registration'            : 'icon-green fas fa-user-plus',
          'NewUserPlace'            : 'icon-green fas fa-wallet',
          'Upgrade'                 : 'icon-purple fas fa-arrow-alt-circle-up',
          'Reinvest'                : 'icon-green fas fa-sync-alt',
          'MissedEthReceive'        : 'icon-yellow fas fa-minus-circle',
          'SentExtraEthDividends'   : 'icon-green fas fa-wallet',
          'CannotSendMoneyEvent'    : '',
          'leadingPartner'          : 'icon-yellow fas fa-minus-circle',
          'leadingPartnerToUpline'  : 'icon-yellow fas fa-minus-circle',
          'leadingPlacePurchase'    : 'icon-green fas fa-wallet',
          'Transfer'                : '',
        },
        // Ассоциация имен событий эфира и трона
        assocEventsEthereumTron : {
            'regLevelEvent'          : 'Registration',
            'newUserPlaceEvent'      : 'NewUserPlace',
            'upgrageEvent'           : 'Upgrade',
            'reinvestEvent'          : 'Reinvest',
            'missedEthReceive'       : 'MissedEthReceive',
            'sentExtraEthDividends'  : 'SentExtraEthDividends',
            'cannotSendMoneyEvent'   : 'CannotSendMoneyEvent',
            'leadingPartner'         : 'leadingPartner',
            'leadingPartnerToUpline' : 'leadingPartnerToUpline',
            'leadingPlacePurchase'   : 'leadingPlacePurchase',
        }
    };
    params.delay    *= 3000;

    // Ethereum
    var ethereumSocket = io.connect('wss://forsage.io:2087', {
        rejectUnauthorized: false,
        rememberTransport: false,
        secure: true,
    });
    ethereumSocket.on('addEvents', function(data) {
        data = JSON.parse(data);
        if (!data.events) {
          console.log('Ethereum[socket]: empty events');
          return;
        }
        if (!data.params.levels) {
          console.log('Ethereum[socket]: empty levels');
          return;
        }
        var e, x, y, i, c, last,
            events = new Array(), 
            levels = data.params.levels,
            object = data.events.reverse();

        for(i = 0; i <= object.length; i++) {
            e = object[i];
            if(!e) {
                continue;
            }
            events[i] = {
                "amount"        : 0,
                "date"          : "0000.00.00 00:00",
                "eventName"     : params.assocEventsEthereumTron[e.type] || '',
                "event_id"      : 0,
                "id"            : e.id,
                "level"         : e.level,
                "level_price"   : levels[e.matrix] ? (levels[e.matrix][e.level] || 0) : 0,
                "matrix"        : e.matrix,
                "referrer_id"   : e.r_id,
                "time"          : e.time2,
                "timestamp"     : e.time + 120,
                "tx"            : "",
                "type"          : "",
                "user_id"       : e.user_id,
                "source"        : 'ethereum',
            };
            
            var ethereumBase = params.container.el.find(' > div:first-child').attr('data-notification_ethereum_base') || 0;
            if(!ethereumBase || ((events[i].matrix == '1' || events[i].matrix == '2') && ethereumBase < events[i].id)) {
                writeByContainer(events[i], 'ethereum');
                if(params.events.length > params.container.countItems) {
                    params.events = params.events.slice(-params.container.countItems)
                }
            }
        }
    });
    ethereumSocket.on('error', function(err) {
        notify(err);
    });


    // Tron
    var tronSocket = io.connect('wss://trx.forsage.io:2096', {
        rejectUnauthorized: false,
        rememberTransport: false,
        secure: true,
    });
    tronSocket.on('addEvents', function(data) {
        data = JSON.parse(data);
        if (!data.events) {
          notify('empty variable "data.events"');
          return;
        }
        var e, x, y, i, last;
        
        var events = data.events.reverse();
// console.log(events)
        for(i = 0; i < events.length; i++) {
            var tronBase     = params.container.el.find(' > div:first-child').attr('data-notification_tron_base')     || 0;
            var tronXGold    = params.container.el.find(' > div:first-child').attr('data-notification_tron_xgold')    || 0;

            if(
                (!tronBase && !tronXGold) 
                || ((events[i].matrix == '1' || events[i].matrix == '2') && tronBase < events[i].id)
                || (events[i].matrix == '3' && tronXGold < events[i].id)
            ) {
                 writeByContainer(events[i], 'tron');
                if(params.events.length > params.container.countItems) {
                    params.events = params.events.slice(-params.container.countItems)
                }
            }
        }
    });
    tronSocket.on('error', function(err) {
        notify(err);
    });

    // Вывести сообщение короткое
    // alertByEvent();

    // Вывод короткого окошка о событии
    function alertByEvent() {
        setInterval(function () {
            if(params.container.wrapper.hasClass('notifications__wrap_show')) {
                return;
            }
            if (!params.events || params.events.length == 0) {
                notify('empty variable "params.events"');
                return;
            }
            // Получить с кук последний указанный ID события
            messageIteration('init');
            let event = null;
            let events = params.events.slice(-3);
            for(let e in events) {
                if(params.messageIteration < events[e].timestamp) {
                    event = events[e];
                    break;
                }
            }
            if(event) {
                let msg = createMessage(event)
                params.container.cell.html(`
                    <div class="notifications__item">
                        <div class="notifications__icon"><i class="icon ${params.eventsTypeIcon[event.eventName]}"></i></div>
                        <div class="notifications__text">
                            <div class="notifications__title">${msg}</div>
                            <div class="notifications__desc elapsedTime" data-elapse_time="${event.time}"></div>
                        </div>
                    </div>
                `);

                params.container.cell.removeClass('notifications__alert_hide');
                setTimeout(function() {
                    params.container.cell.addClass('notifications__alert_hide');
                    params.container.cell.empty();
                }, 2500);
                messageIteration('set', event.timestamp);
            }
        }, params.delay);
    }

    // Запись в контейнер событий
    function writeByContainer(event, source) {
        var msg;

        var ethereumBase = params.container.el.find(' > div:first-child').attr('data-notification_ethereum_base') || 0;
        var tronBase     = params.container.el.find(' > div:first-child').attr('data-notification_tron_base')     || 0;
        var tronXGold    = params.container.el.find(' > div:first-child').attr('data-notification_tron_xgold')    || 0;
        if(source == 'ethereum') {
            ethereumBase = event.id;
        } else if(source == 'tron') {
            if(event.matrix == '1' || event.matrix == '2') {
                tronBase = event.id;
            } else if(event.matrix == '3') {
                tronXGold = event.id;
            }
        }
        // Добавить запись
        msg = createMessage(event);
        params.container.el.prepend(`
            <div class="notifications__item" data-notification_time="${event.timestamp}" data-notification_ethereum_base="${ethereumBase}" data-notification_tron_base="${tronBase}" data-notification_tron_xgold="${tronXGold}">
                <div class="notifications__icon"><i class="icon ${params.eventsTypeIcon[event.eventName]}"></i></div>
                <div class="notifications__text">
                    <div class="notifications__title">${msg}</div>
                    <div class="notifications__desc elapsedTime" data-elapse_time="${event.time}"></div>
                </div>
            </div>
        `);
        // Удалить с контейнера больше чем n записей
        for(let i = params.container.el.find(' > div').length; i > params.container.countItems; i--) {
            params.container.el.find(' > div:last-child').remove();
        }
    }

    function createMessage(event) {
        let msg, 
            course = 0, 
            currencyAbbreviation = '';
        // Тип сообщения
        msg = params.message[event.eventName];
        // Рандомизировать сообщения
        if(Array.isArray(msg)) {
            msg = msg[Math.floor(Math.random() * msg.length)];
        }
        if(event.source && event.source == 'ethereum') {
            currencyAbbreviation = 'ETH';
            course = config.course.ETH_USD;
        } else {
            currencyAbbreviation = 'TRX';
            course = config.course.TRX_USD;
        }
        msg = msg.replace('{referrer_id}', event.referrer_id);
        msg = msg.replace('{user_id}', event.user_id);
        msg = msg.replace('{crypto_name}', currencyAbbreviation);
        msg = msg.replace('{level}', event.level);
        if(event.matrix > 0) {
            msg = msg.replace('{price_level}', event.level_price);
            msg = msg.replace('{currency_usd}', parseFloat( course * event.level_price ) . toFixed(2));
        }
        switch(event.matrix) {
            case '1':
                msg = msg.replace('{matrix}', 'X3');
                break;
            case '2':
                msg = msg.replace('{matrix}', 'X4');
                break;
            case '3':
                msg = msg.replace('{matrix}', 'xGold');
                break;
            default:
                msg = msg.replace('{matrix}', '?');
        }
        return msg;
    }

    function messageIteration(action, key) {
        if (action == 'init') {
          params.messageIteration = cookie('messageIteration');
        }
        if (action == 'set') {
          params.messageIteration = key;
          cookie('messageIteration', params.messageIteration, {expires: 2592e6});
        }
    }
    // Вывод уведомлений веб сокета
    function notify(msg) {
      console.log('JS WebSocket: ', msg);
    }
}

function storageTrigger(key, defaultValue) {
    let val = storage(key);
    if(val == '0') {
        val = '1';
    } else {
        val = '0';
    }
    return storage(key, val, defaultValue);
}

/* Cookie */
function storage(key, val, defaultValue) {
    let storage = getCookie('storage');
    if(!storage) {
        storage = {};
    } else {
        storage = JSON.parse(storage);
    }
    if(val) {
        // Значение по умолчанию если значение еще не установленно
        if(!storage.hasOwnProperty(key)) {
            val = defaultValue ? 1 : 0;
        }
        storage[key] = val;
        setCookie(
            'storage', 
            JSON.stringify(storage),
            {
                expires: 31104e3
            }
        );
        return val;
    }
    return storage.hasOwnProperty(key) ? storage[key] : null;
}

function cookie(key, val, opts) {
    if(val) {
        return setCookie(key, val, opts)
    }
    return getCookie(key);
}

function getCookie(name) {
  let matches = document.cookie.match(new RegExp(
    "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
  ));
  return matches ? decodeURIComponent(matches[1]) : undefined;
}

function setCookie(name, value, options = {}) {
    let defaultOptions = {
        path: '/',
    };
    options = Object.assign(defaultOptions, options);
    if (options.expires instanceof Date) {
        options.expires = options.expires.toUTCString();
    } else {
        if(options.expires) {
            options.expires = new Date(Date.now() + Number.parseInt(options.expires));
        }
    }
    let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);
    for (let optionKey in options) {
        updatedCookie += "; " + optionKey;
        let optionValue = options[optionKey];
        if (optionValue !== true) {
            updatedCookie += "=" + optionValue;
        }
    }
    document.cookie = updatedCookie;
}

(function() {
    'use strict';

    // Триггер значений
    $('[data-trigger_value]').click(function () {
        let el, sib, out, val, res;
        el = out = $(this);
        if(el.find('span').length) {
            out = el.find('span');
        }
        val = el.data('trigger_value').split('|');
        if(out.text() == val[0]) {
            res = val[1];
        } else {
            res = val[0];
        }
        out.text(res);

        sib = el.data('trigger_value_siblings');
        if(sib) {
            sib = $(sib);
            if(sib.find('span').length) {
                sib = sib.find('span');
            }
            sib.text(res);
        }
    });

    // Спойлер
    $('[data-spoiler]').click(function () {
        let key = $(this).data('spoiler');
        $(key).slideToggle(); 
    });

    // Translates
    window.l = function l(key) {
        if(!config || !config.lang || !config.lang.hasOwnProperty(key)) {
            return 'no translate';
        }
        return config.lang[key];
    };

    // Copy text
    window.copyText = function(value) {
        var s = document.createElement('input');
        s.value = value;
        document.body.appendChild(s);

        if(navigator.userAgent.match(/ipad|ipod|iphone/i)) {
            s.contentEditable = true;
            s.readOnly = false;
            var range = document.createRange();
            range.selectNodeContents(s);
            var sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
            s.setSelectionRange(0, 999999);
        }
        else {
            s.select();
        }
        try {
            document.execCommand('copy');
            Notice.success(
                l('copied')
            );
        }
        catch (err) {
            Notice.error('Copied error: ' + err.message);
        }
        s.remove();
    };

  // Notices service
    // window.Notice = new Vue({
    //     el: '#Notice',
    //     template: `
    //         <div class="notice" v-if="items.length">
    //             <div class="notice__darken" v-if="item.darken"></div>
    //             <div class="notice__wrap" @mouseover.once="item.lifetime > 0 ? (item.lifetime = 0) || clearTimeout(item._timeout) : null" :style="{width: item.width + 'px'}" :class="[item.type, 'notice__wrap_x-' + item.x, 'notice__wrap_y-' + item.y]" :key="item">
    //                 <div class="notice__close" v-if="item.canclose" @click="close(item)"></div>
    //                 <i class="notice__icon fa" v-if="item.icon" :class="['fa-' + item.icon]"></i>
    //                 <div class="notice__body">
    //                     <div class="notice__title" v-if="item.title" v-html="item.title"></div>
    //                     <div v-if="item.text" v-html="item.text"></div>
    //                     <div class="notice__btns">
    //                         <button v-for="(v, k) in item.buttons" @click="v(item) !== false ? close(item) : null" v-text="k"></button>
    //                     </div>
    //                 </div>
    //                 <div v-if="item.lifetime > 0" class="notice__progress" :style="{animation: 'notice__progress_anim ' + (item.lifetime / 1000) + 's linear'}"></div>
    //             </div>
    //         </div>
    //     `,
    //     data: {
    //         items: []
    //     },
    //     mounted() {
    //         let s = document.createElement('style');
    //         s.innerHTML = `
    //             .notice {}
    //                 .notice__darken { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
    //                 .notice__wrap { position:fixed; z-index:1002; background:#fff; color:#000; box-shadow:0 4px 12px rgba(0,0,0,.1); overflow:hidden; border-radius:3px; }
    //                     .notice__wrap.primary { background:var(--primary-color); color:#fff; }
    //                     .notice__wrap.secondary { background:var(--secondary-color); color:#fff; }
    //                     .notice__wrap.success { background:var(--success-color); color:#fff; }
    //                     .notice__wrap.error { background:var(--error-color); color:#fff; }
    //                     .notice__wrap.warning { background:var(--warning-color); color:#fff; }
    //                     .notice__wrap_x-left { left:30px; }
    //                     .notice__wrap_x-center { left:50%; transform:translateX(-50%); }
    //                     .notice__wrap_x-right { right:30px; }
    //                     .notice__wrap_y-top { top:30px; }
    //                     .notice__wrap_y-center { top:50%; transform:translateY(-50%); }
    //                     .notice__wrap_y-bottom { bottom:30px; }
    //                     .notice__wrap_x-center.notice__wrap_y-center { transform:translate(-50%); }
    //                 .notice__close { position:absolute; top:8px; right:8px; opacity:0.3; cursor:pointer; padding:15px; background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+Y2xvc2U8L3RpdGxlPjxnIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlPSIjMDAwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0xIDFsMTIgMTJNMTMgMUwxIDEzIi8+PC9nPjwvc3ZnPg==) center center no-repeat; }
    //                     .notice__close:hover { opacity:0.7; }
    //                 .notice__icon { font-size:21px; position:absolute; top:13px; left:13px; }
    //                 .notice__body { padding:15px 45px 15px 20px; }
    //                     .notice__icon ~ .notice__body { padding-left:50px; }
    //                 .notice__title { font-size:15px; font-weight:600; margin:0 0 5px; }
    //                 .notice__btns > * { margin:10px 0 0; border:1px solid rgba(0,0,0,0.3); cursor:pointer; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,.1); color:#000; padding:7px 20px; border-radius:2px; transition:0.2s; }
    //                     .notice__btns > *:hover { box-shadow:0 1px 4px rgba(0,0,0,.2); }
    //                 .notice__progress { position:absolute; bottom:0; left:0; height:5px; width:100%; background:rgba(0,0,0,0.3); }
    //                     @keyframes notice__progress_anim {0% { width:100%; } 100% { width:0%; } }
    //         `;
    //         document.head.appendChild(s);
    //     },
    //     computed: {
    //         item() { return this.items[this.items.length - 1]; }
    //     },
    //     methods: {
    //         show(text, params) {
    //             let item = Object.assign({x: 'center', y: 'top', width: 320, type: '', icon: '', text: text, title: '', buttons: {}, lifetime: 5000, canclose: true, darken: false}, params || {});
    //             this.items.push(item);
    //             if(item.lifetime > 0) item._timeout = setTimeout(() => { this.close(item); }, item.lifetime);
    //         },
    //         close(item) {
    //             if(item._timeout) clearTimeout(item._timeout);
    //             this.items.splice(this.items.indexOf(item), 1);
    //         },
    //         info(msg) { this.show(msg, {type: 'primary', icon: 'info-circle'}); },
    //         success(msg) { this.show(msg, {type: 'success', icon: 'check-circle'}); },
    //         error(msg) { this.show(msg, {type: 'error', icon: 'ban'}); },
    //         warning(msg) { this.show(msg, {type: 'warning', icon: 'exclamation-circle'}); },
    //         alert(msg, title) { this.show(msg, {x: 'center', y: 'top', title: title || location.host, lifetime: 0, buttons: {OK: () => {}}}); },
    //     }
    // });

    jQuery.fn.elapsedTime = function (selector, source, options = {}) {
        var options = jQuery.extend({
            lang: {
                years:   ['год', 'года', 'лет'],
                months:  ['месяц', 'месяца', 'месяцев'],
                days:    ['день', 'дня', 'дней'],
                hours:   ['час', 'часа', 'часов'],
                minutes: ['минута', 'минуты', 'минут'],
                seconds: ['секунда', 'секунды', 'секунд'],
                end: " назад",
                freshly: "только что",
            },
            plurar:  function(n) {
                return (n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);
            },
            intervalUpdate: 1,
        }, options);
        options.intervalUpdate *= 1e3;

        var timeDifference = function(end, begin) {
            if (end < begin) {
                return false;
            }
            var difference = {
                seconds: [end.getSeconds() - begin.getSeconds(), 60],
                minutes: [end.getMinutes() - begin.getMinutes(), 60],
                hours:   [end.getHours()   - begin.getHours()  , 24],
                days:    [end.getDate()    - begin.getDate()   , new Date(begin.getYear(), begin.getMonth() + 1, 0).getDate()],
                months:  [end.getMonth()   - begin.getMonth()  , 12],
                years:   [end.getYear()    - begin.getYear()   , 0]
            };
            if(difference.years[0] != 0) {
                delete (difference.days);   
                delete (difference.hours);   
                delete (difference.minutes);
                delete (difference.seconds);
            }
            else if(difference.months[0] != 0) { 
                delete (difference.hours);  
                delete (difference.minutes); 
                delete (difference.seconds);
            }
            else if(difference.days[0] != 0) {
                delete (difference.minutes);
                delete (difference.seconds);
            }
            else if(difference.hours[0] != 0) {
                delete (difference.seconds);
            } 
            else if(difference.minutes[0] != 0) {
                delete (difference.seconds);
            }
            var result = new Array();
            var flag = false;
            for (let i in difference) {
                if (flag) {
                    difference[i][0]--;
                    flag = false;
                }     
                if (difference[i][0] < 0) {
                    flag = true;
                    difference[i][0] += difference[i][1];
                }
                if (!difference[i][0]) {
                    continue;
                }
                result.push(difference[i][0] + ' ' + options.lang[i][options.plurar(difference[i][0])]);
            }
            return result.reverse().join(' ');
        };
        var elapsedTime = function () {
            var need_to_time_update = $(selector);
            if(need_to_time_update.length > 0) {
                need_to_time_update.each(function(i) {
                    var date = need_to_time_update.eq(i).attr(source).toString().split(",");
                    if(!date[5]) {
                        date[5] = 0;
                    }
                    var s = timeDifference(
                        new Date(), 
                        new Date(
                            date[0],
                            date[1] - 1,
                            date[2],
                            date[3],
                            date[4],
                            date[5]
                        )
                    );
                    if (s.length) {
                        need_to_time_update.eq(i).html(s+options.lang.end);
                    }
                    else {
                        need_to_time_update.eq(i).html(options.lang.freshly);
                    }
                });
            }
        };

        elapsedTime();
        setInterval(elapsedTime, options.intervalUpdate);
    };

    $("body").elapsedTime(
        '.elapsedTime',
        'data-elapse_time',
        {
            lang: {
                years:   [
                    l('elt-years_0'), 
                    l('elt-years_1'), 
                    l('elt-years_2')
                ],
                months:  [
                    l('elt-months_0'), 
                    l('elt-months_1'), 
                    l('elt-months_2')
                ],
                days:    [
                    l('elt-days_0'),
                    l('elt-days_1'),
                    l('elt-days_2'),
                ],
                hours:   [
                    l('elt-hours_0'),
                    l('elt-hours_1'),
                    l('elt-hours_2'),
                ],
                minutes: [
                    l('elt-minutes_0'),
                    l('elt-minutes_1'),
                    l('elt-minutes_2'),
                ],
                seconds: [
                    l('elt-seconds_0'),
                    l('elt-seconds_1'),
                    l('elt-seconds_2'),
                ],
                end: l('elt-end'),
                freshly: l('elt-freshly'),
            }
        }
    );
})();